
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Using differencing disks with VirtualBox /在VirtualBox下使用系统差分 - Ocean's Blog</title>
	<meta name="author" content="Ocean">

	
	<meta name="description" content="from http://lucvknet.blogspot.com/2010/01/using-differencing-disks-with.html
When evaluating new software, you often need to setup an isolated &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Ocean's Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Ocean's Blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">主页</a></li>
	<li><a href="/blog/archives">存档</a></li>
	<li><a href="/blog/categories">分类</a></li>
	<li><a href="/blog/about">关于</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">主页</a></li>
	<li><a href="/blog/archives">存档</a></li>
	<li><a href="/blog/categories">分类</a></li>
	<li><a href="/blog/about">关于</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:blog.nwy.me">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:blog.nwy.me">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Using Differencing Disks With VirtualBox /在VirtualBox下使用系统差分</h2>
	<div class="entry-content"><p>from http://lucvknet.blogspot.com/2010/01/using-differencing-disks-with.html
When evaluating new software, you often need to setup an isolated environment using virtual machines. This can be a lot of work when you have to install the machines from scratch. To avoid this you can setup a base configuration (for instance a machine which already has SQL server and Visual Studio installed) and copy the hard disk when creating a new instance. The downside of this method is that you waste a lot of disk space. To avoid this most virtualization products such as VmWare, VirtualBox and Virtual PC use differencing disks. These are disks that store only the different sectors in regard to their base or parent disk.</p>

<!--more-->


<p>Following procedure shows how to use differencing disks with VirtualBox:</p>

<ol>
<li>Build the base system.
After installing the operating system, apply all necessary update and install the VirtualBox additions.</li>
<li>Release the base disk
Since the base disk will become ‘read-only’, it must be detached form all virtual machines.
<a href="http://nwy.me/img/2011/03/ReleaseDisc_thumb7.jpg"><img src="http://nwy.me/img/2011/03/ReleaseDisc_thumb7-300x236.jpg" alt="" title="ReleaseDisc_thumb[7]" width="300" height="236" class="alignnone size-medium wp-image-62616"></a>
3 Make the base disk immutable
Use the following command:
VBoxManage modifyhd <disk file>  &#8211;type immutable</li>
</ol>


<p><del datetime="2011-03-02T11:00:22+00:00">把文件权限设为400</del>
4 Create a new system from the base disk
When creating the new system attach the immutable base disk. A new differencing disk will be created.
<a href="http://nwy.me/img/2011/03/NewSystem_thumb1.jpg"><img src="http://nwy.me/img/2011/03/NewSystem_thumb1-300x225.jpg" alt="" title="NewSystem_thumb[1]" width="300" height="225" class="alignnone size-medium wp-image-62617"></a>
<a href="http://nwy.me/img/2011/03/NewDisc_thumb1.jpg"><img src="http://nwy.me/img/2011/03/NewDisc_thumb1-300x150.jpg" alt="" title="NewDisc_thumb[1]" width="300" height="150" class="alignnone size-medium wp-image-62618"></a>
5   5. Turn off the autoreset feature of the differencing disk</p>

<pre><code>  This is necessary since the content of a differencing disk will be destroyed when the virtual machine is started.
  Use the following command:
  VBoxManage modifyhd &lt;differencing disk file&gt; --autoreset false
</code></pre>

<p>If you want to start a new hierarchy from a differencing disk, you can use the ‘VBoxManage clonehd’ command to build the new base disk. Following figure shows an example:</p>

<p><a href="http://nwy.me/img/2011/03/diskgen_thumb1.jpg"><img src="http://nwy.me/img/2011/03/diskgen_thumb1-300x260.jpg" alt="" title="diskgen_thumb[1]" width="300" height="260" class="alignnone size-medium wp-image-62619"></a></p>

<p>转移user目录</p>

<p>1、新系统安装时：</p>

<p>　　在安装Win7的过程中，要求输入用户名及密码的时候，先不如输入任何信息，按“Shift+F10”呼出DOS窗口，输入以下命令：</p>

<p>　　robocopy &#8220;C:\Users&#8221; &#8220;D:\Users&#8221; /E /COPYALL /XJ    &#8212;&#8212;而后按下回车键，再输入</p>

<p>　　rmdir &#8220;C:\Users&#8221; /S /Q   &#8212;&#8212;再按下回车键，最后输入</p>

<p>　　mklink /J &#8220;C:\Users&#8221; &#8220;D:\Users&#8221;    &#8212;&#8212;以回车键结束命令输入</p>

<p>　　而后关闭DOS窗口，按部就班继续安装直至完成。</p>

<p>　　如此安装的Windows7，所有“用户特殊文件夹”（User Special Folder）的内容都已经被设置在D盘（非系统盘）上。</p>

<p>2、已经安装好的win7系统：</p>

<p>　　如果想要移动已安装好的Windows7中的用户文件夹，那么就要按以下步骤操作（稍微麻烦一点，并且过程中可能会出现无法拷贝文件的情况）：</p>

<p>①关闭所有应用程序：</p>

<p>　　1. 按一下“Windows”键，输入“计算机管理”之后按“Enter”，呼出“计算机管理器”；</p>

<p>　　2. 鼠标点击“Administrator”，选择属性，而后在随后的对话框中去掉“帐户已禁用”之前的勾，而后关闭“计算机管理器”；</p>

<p>　　3. 注销当前用户（注意，不是“切换用户”），而后以“Administrator”登录</p>

<p>　　4. 打开命令行窗口，输入以下命令：robocopy &#8220;C:\Users&#8221; &#8220;D:\Users&#8221; /E /COPYALL /XJ /XD &#8220;C:\Users\Administrator&#8221;</p>

<p>　　5. 注销Administrator，重新用你的用户名登录Windows7，而后到“计算机管理器”里禁用Administrator；</p>

<p>　　6. 以管理员身份打开一个DOS窗口，输入以下命令：</p>

<p>　　rmdir &#8220;C:\Users&#8221; /S /Q</p>

<p>　　mklink /J &#8220;C:\Users&#8221; &#8220;D:\Users&#8221;</differencing></disk></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-03-02T00:00:00+08:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/other/'>Other</a>


</div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Ocean

<div style="display:none"> <script language="javascript" type="text/javascript" src="http://js.users.51.la/4388679.js"></script>
<noscript><a href="http://www.51.la/?4388679" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/4388679.asp" style="border:none" /></a></noscript> </div></footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'oceanblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.nwy.me/blog/2011/03/02/using-differencing-disks-with-virtualbox/';
        var disqus_url = 'http://blog.nwy.me/blog/2011/03/02/using-differencing-disks-with-virtualbox/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>

<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Unix/Linux上的后门技术和防范 - 0cean's Blog|0cean的个人博客</title>
	<meta name="author" content="0cean">

	
	<meta name="description" content="Unix/Linux上的后门技术和防范 对黑客来讲，入侵一个系统只是万里长征的开始，最主要的是长期占有一个肉鸡（傀儡机）， 所以，后门技术往往非常重要。对于我们来讲，总是处于被动的地位，百密一疏，总有没有做到位的地方，谁都不能保证自己的系统是绝对安全的，所以不能避免我 们可能会被入侵。 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="0cean's Blog|0cean的个人博客" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">0cean's Blog|0cean的个人博客</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">主页</a></li>
	<li><a href="/blog/archives">存档</a></li>
	<li><a href="/blog/categories">分类</a></li>
	<li><a href="/blog/about">关于</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">主页</a></li>
	<li><a href="/blog/archives">存档</a></li>
	<li><a href="/blog/categories">分类</a></li>
	<li><a href="/blog/about">关于</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:blog.nwy.me">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:blog.nwy.me">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Unix/Linux上的后门技术和防范</h2>
	<div class="entry-content"><p>Unix/Linux上的后门技术和防范</p>

<p>对黑客来讲，入侵一个系统只是万里长征的开始，最主要的是长期占有一个肉鸡（傀儡机）， 所以，后门技术往往非常重要。对于我们来讲，总是处于被动的地位，百密一疏，总有没有做到位的地方，谁都不能保证自己的系统是绝对安全的，所以不能避免我 们可能会被入侵。黑客入侵后肯定会留后门，当然，除了那些高手，境界非常高，入侵只是为了测试或者技术挑战，对于一般黑客来讲，入侵之后留个后门是很重要 的，我们要防范，当然就要了解常用的后门技术，下面就简单的讲将在Unix/Linux系统中比较常见的后门技术。</p>

<p>1.帐号后门</p>

<p>最普通和原始的后门技术，一般就是在系统中添加一个管理员帐户。</p>

<h1>echo”heiyeluren：*：0：0：：/root：/bin/sh”>；>；/etc/passwd</h1>

<h1>echo”heiyeluren：：0：0：：0：0：：/root：/bin/sh”>；>；/etc/shadow</h1>

<p>给系统增加一个uid和gid都为0（root）的帐号，无口令。</p>

<p>FreeBSD的密码是存储在/etc/master.passwd里面的，那么后面的命令就应该改成：</p>

<h1>echo”heiyeluren：：：：：：：：：”>；>；/etc/master.passwd</h1>

<p>也可以使用程序来实现：</p>

<p>/<em>Addsuperuser</em>/</p>

<h1>include”stdio.h”</h1>

<h1>definePASSWD_PATH”/etc/passwd”</h1>

<h1>defineSHADOW_PATH”/etc/master.passwd”</h1>

<p>main（）</p>

<p>{</p>

<p>FILE*fd；</p>

<p>fd=fopen（PASSWD_PATH，”a+”；</p>

<p>fprintf（fd，”heiyeluren：*：0：0：：/root：/bin/sh\n”；</p>

<p>fclose（fd）；</p>

<p>fd=fopen（SHADOW_PATH，”a+”；</p>

<p>fprintf（fd，”heiyeluren：：0：0：：0：0：：/root：/bin/sh\n”；</p>

<p>fclose（fd）；</p>

<p>}</p>

<h1>gcc-oadduseradduser.c</h1>

<h1>./adduser</h1>

<p>这种方法比较傻，一般比较容易发现，特别是系统帐户不多的时候。也有的用户名起的比较迷惑人，比如起个r00t的用户名，uid和gid都是0，这样如果不注意，可能就会被蒙混过关了。</p>

<!--more-->


<p>*防范方法：</p>

<p>这 种方法虽然比较容易发现，但是我们还是要防范，要多注意观察系统的帐户情况，本来我们系统帐户就不多，检查起来比较方便，另外也要注意那些比较少使用的帐 户是不是被更改过，比如默认的帐户有bind，它的shell是/usr/sbin/nologin，就是不能登陆的，但是黑客入侵后把它改了，比如改为 /bin/csh，那么对方就能登陆了，但是你确不知道。所以最好办法是把/etc/passwd另外备份一份，不定期的检查，同时把/etc /passwd和/etc/master.passwd设为只有root才能查看。</p>

<p>2.shell后门</p>

<p>这个比较常用，也比较流行。一般就是把root执行的shell程序通过setuid的形式把shell程序拷贝到其他能够执行的地方，然后只要用小权限用户执行该shell就能够直接获取root权限。</p>

<p>比如：</p>

<h1>cp/bin/sh/tmp/.backdoor</h1>

<h1>chownroot：root/tmp/.backdoor</h1>

<h1>chmod+s/tmp/.backdoor</h1>

<p>这 样只是把sh复制了，如果你喜欢其他shell，比如ksh、csh也可以，具体你看各个不同的操作系统而定。你就可以把那个加了s标记的shell程序 放到任何目录，最好是深一点，不容易被人发现的地方，比如/usr/local/share/man之类的目录，然后你使用小权限用户登陆后执行该 shell就可以了，比如我们上面复制的shell，我们只要用小权限用户登陆后执行：</p>

<p>$/tmp/.backdoor</p>

<p>#</p>

<p>就可以了，当然，如何获得小权限用户，你可以使用暴力破解一些帐户，或者自己创建一个小权限的帐户。</p>

<p>*防范方法：</p>

<p>首先给各个主要目录加上我们上面说的文件指纹校验，知道某个目录下有什么文件，如果多出了可疑文件可以仔细检查。还有使用find命令来查找有没有危险的rootsuid程序：</p>

<p>find/-typef（-perm-4000-o-perm-2000）-print</p>

<p>3.Crontab服务后门</p>

<p>crontab命令就相当于windows下的at命令，定期执行某些任务。对黑客来讲，比如定期建立一个帐户，然后过多久就删除，这样管理员永远看不到系统中有后门，这样是非常保险的……</p>

<p>*防范方法：</p>

<p>cron的服务默认是存储在/var/spool/crontab/root目录下，定期检查cron服务，看是否有异常的任务在执行，或者如果你不使用cron的话，直接关闭掉它。</p>

<p>4.rhosts后门</p>

<p>Rhosts 文件常常被黑客利用来制作后门，如果系统开了rlogin、rexec等r的服务，因为象rlogin这样的服务是基于rhosts文件里的主机名使用简 单的认证方法，所以黑客只要将。rhosts文件设置成”++”，那么就允许任何人从任何地方使用该用户名，无须口令登陆513端口的rlogin服务就 行。而且r之类的服务没有日志能力，不容易被发现。</p>

<p>实现方法：</p>

<h1>echo”++”>；/usr/heiyeluren/.rhosts</h1>

<h1>rlogin-lheiyelurenlocalhost</h1>

<p>这样就不需要任何密码，直接输入用户名heiyeluren就登陆到了系统。</p>

<p>*防范办法：</p>

<p>不要使用rlogin等服务，同时也不推荐使用telnet等服务，因为telnetd等守护进程溢出漏洞一堆，而且在数据传输过程中是没有加密的，很容易被嗅探，建议使用ssh等经过安全加密的服务来替代。</p>

<p>5.Login后门</p>

<p>login程序通常用来对telnet来的用户进行口令验证。入侵者获取login的原代码并修改使它在比较输入口令与存储口令时先检查后门口令。如果用户敲入后门口令，它将忽视管理员设置的口令让你长驱直入。</p>

<p>*防范方法：</p>

<p>一般针对这类后门，一般都是使用”string”命令搜索login程序中是否有中是否有密码等字符串来进行检查。如果密码经过加密，那么就对login文件进行指纹记录和MD5值的记录，觉得异常时进行检测。</p>

<p>6.Bind后门</p>

<p>就是通过常用的网络连接协议TCP/UDP/ICMP来建立连接的后门，这个在Windows下可是轰轰烈烈。</p>

<p>比 较普遍的有TCP协议的后门都是写一段程序开一个指定的端口进行监听，然后从客户端进行连接后登陆系统。也有黑客为了隐蔽使用UDP协议来连接。icmp 后门也常见，一般是。有时候可能bind后门跟服务后门结合，黑客通过自己写的bind后门来替换inetd中的服务。</p>

<p>*防范方法：</p>

<p>经常使用netstat命令检查有没有非法的端口打开，最好直接用防火墙屏蔽除了正常访问的端口之外的端口。对于ping后门的话，直接在防火墙上禁止ping服务器</p>

<p>7.服务后门</p>

<p>一 般是替换或者添加服务来实现后门。比如在/etc/inetd.conf中添加或者替换某个服务来运行自己的后门程序，或者在某些服务中加入自己的后门代 码。如果是替换服务的话，该服务必须不被使用，而且不容易发现。如果是自己添加的服务，那么必须在/etc/services中设置对应的服务和端口才能 使用。</p>

<p>*防范方法：</p>

<p>经常检查服务，最好备份/etc/inetd.conf、/etc/services等文件，同时在 FreeBSD下也要时常检查/usr/loca/etc/rc.d下面的脚本是否是合法的并且是否那些脚本里面有没有启动非法程序。如果是在服务程序中 添加自己的代码，那么就要对文件的指纹进行校验，比如md5值看是否匹配。</p>

<p>8.rootkit后门</p>

<p>rootkit后门一般是替换管理员使用的工具，比如ls、ps、netstat、who等常用文件，把那些程序替换成被黑客加了特殊代码的程序，那样就能达到控制的效果。而且现在已经有很多现成能下载使用的rootkit.</p>

<p>*防范方法：</p>

<p>按照我们前面的方法，给每个文件建立系统指纹档案和md5校验值，如果觉得不对劲的时候查看文件指纹是否匹配，有没有别修改过，就知道是否着了rootkit的道。</p>

<p>9.内核后门</p>

<p>通过加载内核模块的方式来加载后门，比较复杂。一般内核后门都是针对操作系统而言的，不同的操作系统内核模块设置编写方法都不一样，一般不通用。内核后门一般无法通过md5校验等来判断，所有基本比较难发现，目前针对内核后门比较多的是Linux和Solaris下。</p>

<p>*防范方法：</p>

<p>FreeBSD下通过我们上面讲的设置内核安全等级来控制加载内核模块。</p>

<p>10.其他后门</p>

<p>还有包括。forward等其他各类后门，另外很多后门可能是结合多种技术，比如把rootkit和内核后门结合在一起，实际过程中，黑克是会更难对付的。当然还有许多我们没有发现高手独门秘诀，这需要灵活检查，不过只要勤劳一点，安全会提升很多。</p>

<p>六、结束语</p>

<p>安 全是一个整体，即使那么服务你设置的非常安全，但是不能保证永远安全，安全是动态的，必须不断的充实自己的知识，发现新漏洞、新技术。如果你需要更安全的 系统，一定要自己有时常能够手工作入侵检测或者使用部分工具帮助你进行入侵检测。同时推荐你安装一些网络入侵检测系统（NIDS），比如Snort.</p>

<p>－－本文系Other自网络。</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-03-31T00:00:00+08:00" pubdate data-updated="true">Mar 31<span>st</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/other/'>Other</a>


</div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    0cean

<div style="display:none"> <script language="javascript" type="text/javascript" src="http://js.users.51.la/4388679.js"></script>
<noscript><a href="http://www.51.la/?4388679" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/4388679.asp" style="border:none" /></a></noscript> </div></footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'oceanblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.nwy.me/blog/2011/03/31/unix-linux-technology-and-to-prevent-the-back-door/';
        var disqus_url = 'http://blog.nwy.me/blog/2011/03/31/unix-linux-technology-and-to-prevent-the-back-door/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>